<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Messaging Queue Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body class="bg-light">
<div class="container py-4">
    <h1 class="mb-4">Messaging Queue Dashboard</h1>
    <div class="row mb-3">
        <div class="col-md-4">
            <div class="card text-center">
                <div class="card-header">Queue Depth</div>
                <div class="card-body">
                    <h2 id="queueDepth">0</h2>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-center">
                <div class="card-header">Processed Messages</div>
                <div class="card-body">
                    <h2 id="processedCount">0</h2>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-center">
                <div class="card-header">Error Rate</div>
                <div class="card-body">
                    <h2 id="errorRate">0%</h2>
                </div>
            </div>
        </div>
    </div>
    <canvas id="statsChart"></canvas>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
async function fetchStats() {
    const res = await fetch('/api/messages/stats');
    return res.json();
}
async function fetchQueueDepth() {
    const res = await fetch('/api/metrics');
    return res.json();
}
async function render() {
    const stats = await fetchStats();
    const metrics = await fetchQueueDepth();
    document.getElementById("queueDepth").textContent = metrics.queueDepth || 0;
    document.getElementById("processedCount").textContent = stats.Processed || 0;
    const errors = stats.Failed || 0;
    const total = Object.values(stats).reduce((a, b) => a + b, 0);
    document.getElementById("errorRate").textContent = total ? Math.round(errors / total * 100) + "%" : "0%";
    // Chart (example, update as needed)
    const ctx = document.getElementById('statsChart').getContext('2d');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: Object.keys(stats),
            datasets: [{
                label: 'Messages',
                data: Object.values(stats),
                backgroundColor: 'rgba(54, 162, 235, 0.7)'
            }]
        }
    });
}
render();
</script>
</body>
</html>